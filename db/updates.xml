<?xml version="1.0" encoding="UTF-8"?>
<updates>
	<!-- Beispiel 
		Aenderungen, die die Struktur der Datenbank aendern, sollten getrennt von reinen 
		Aenderungen an den Daten gehalten werden. Dies erleichtert das aktualliseren des Servers
		und auch eigener Datenbestaende, die man ggf angepasst hat. 
		Ausgenommen sind Aenderungen an den Daten, die in Folge von Strukturaenderungen zwingent notwendig
		sind. Diese sollten jedoch generisch formuliert sein, so dass sie nicht nur auf den Beispiedaten
		funktionieren.
		Die Identifikation erfolgt ueber das Attribut type, das entweder den Wert "structure", "data" 
		oder "text" annehmen kann ("text" bezeichnet Updates, zu denen kein SQL-Kommando sondern nur eine
		Beschreibung existiert)
		Zusaetzlich verfuegt jedes update ueber ein Datum in der Form "JJJJ-MM-TT".
		
		<update type="structure" datum="2006-10-31"><![CDATA[
			ALTER TABLE academy ...;
			CREATE TABLE irgendwas (....);
		]]></update>
		
		<update type="data" datum="2006-11-01"><![CDATA[
			INSERT INTO ammo (name) VALUES ("Meine ganz tolle neue Supermunition");
			UPDATE ship_types SET crew=1 WHERE crew > 1;
		]]></update>
		 
	-->
	<update type="data" datum="2006-11-11"><![CDATA[
		UPDATE users SET ally=0 WHERE id=-15;									
	]]></update>
	<update type="data" datum="2006-11-11"><![CDATA[
		UPDATE users SET passwort='98f6bcd4621d373cade4e832627b4f6' WHERE passwort='098f6bcd4621d373cade4e832627b4f6';
	]]></update>
	<update type="structure" datum="2006-11-11"><![CDATA[	
		CREATE TABLE `werften` (
  			`id` int(11) NOT NULL auto_increment,
  			`type` smallint(6) NOT NULL default '0',
  			`building` int(11) NOT NULL default '0',
  			`item` smallint(6) NOT NULL default '-1',
  			`remaining` tinyint(4) NOT NULL default '0',
  			`flagschiff` tinyint(1) unsigned NOT NULL default '0',
  			`col` int(11) NOT NULL default '0',
  			`shipid` int(11) NOT NULL default '0',
  			`linked` int(10) unsigned NOT NULL default '0',
  			PRIMARY KEY  (`id`),
  			KEY `col` (`col`),
  			KEY `shipid` (`shipid`)
		) ENGINE=InnoDB DEFAULT CHARSET=utf8;
	]]></update>
	<update type="structure" datum="2006-11-26"><![CDATA[	
		CREATE TABLE `config_vacmodes` (
		  `id` int(11) NOT NULL auto_increment,
		  `dauer` int(10) unsigned NOT NULL default '1',
		  `vorlauf` int(10) unsigned NOT NULL default '1',
		  PRIMARY KEY  (`id`)
		) ENGINE=InnoDB DEFAULT CHARSET=utf8;
		
		INSERT INTO `config_vacmodes` (`id`, `dauer`, `vorlauf`) VALUES (1, 35, 14),
		(2, 49, 14),
		(3, 98, 14),
		(4, 147, 14),
		(5, 196, 14);
	]]></update>
	<update type="structure" datum="2006-12-01"><![CDATA[
		ALTER TABLE `quests_running` CHANGE `execdata` `execdata` BLOB NOT NULL;
		ALTER TABLE `ships` CHANGE `scriptexedata` `scriptexedata` BLOB NULL DEFAULT NULL;
	]]></update>
	<update type="structure" datum="2006-12-01"><![CDATA[
		ALTER TABLE users CHANGE nstat nstat VARCHAR(30) NOT NULL DEFAULT '';
		ALTER TABLE stats_verkaeufe CHANGE system system TINYINT NOT NULL DEFAULT 1;
	]]></update>
	<update type="structure" datum="2007-01-06"><![CDATA[
		ALTER TABLE ships ADD INDEX type (type);
	]]></update>
	<update type="structure" datum="2007-01-06"><![CDATA[
		CREATE TABLE `config_felsbrocken_systems` (
		  `system` tinyint(4) NOT NULL default '1',
		  `count` int(11) NOT NULL default '1',
		  PRIMARY KEY  (`system`)
		) ENGINE=InnoDB DEFAULT CHARSET=utf8;
		
		INSERT INTO `config_felsbrocken_systems` (`system`, `count`) VALUES (7, 130);

		CREATE TABLE `config_felsbrocken` (
		  `id` int(11) NOT NULL auto_increment,
		  `shiptype` int(11) NOT NULL default '0',
		  `system` tinyint(4) NOT NULL default '1',
		  `chance` tinyint(4) NOT NULL default '1',
		  `cargo` varchar(255) NOT NULL default '0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,',
		  PRIMARY KEY  (`id`),
		  KEY `system` (`system`),
		  KEY `fk_config_felsbrocken_shiptype` (`shiptype`)
		) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Die verschiedenen Felsbrockenbestueckungen';
		
		INSERT INTO `config_felsbrocken` (`id`, `shiptype`, `system`, `chance`, `cargo`) VALUES (1, 77, 7, 55, '0,0,0,0,0,0,0,0,0,4,0,0,0,0,7,0,0,0,'),
		(2, 77, 7, 28, '0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,'),
		(3, 77, 7, 15, '0,0,0,0,0,0,0,6,0,0,0,0,0,0,20,0,0,0,'),
		(4, 77, 7, 2, '0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,');
		
		ALTER TABLE `config_felsbrocken`
		  ADD CONSTRAINT `fk_config_felsbrocken_system` FOREIGN KEY (`system`) REFERENCES `config_felsbrocken_systems` (`system`) ON DELETE NO ACTION ON UPDATE NO ACTION,
		  ADD CONSTRAINT `fk_config_felsbrocken_shiptype` FOREIGN KEY (`shiptype`) REFERENCES `ship_types` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION;
	]]></update>
	<update type="structure" datum="2007-01-07"><![CDATA[
		ALTER TABLE transmissionen ADD INDEX empfaenger (empfaenger,gelesen);
	]]></update>
	<update type="structure" datum="2007-01-07"><![CDATA[
		ALTER TABLE skn ADD INDEX channel (channel);
		ALTER TABLE skn_visits DROP INDEX user, ADD INDEX user (user, channel);
	]]></update>
	<update type="structure" datum="2007-01-14"><![CDATA[
		ALTER TABLE ships_baubar CHANGE costs costs VARCHAR( 100 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT '0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,'
	]]></update>
	<update type="structure" datum="2007-01-20"><![CDATA[
		DELIMITER //
		CREATE FUNCTION newIntelliShipID(minid INT) RETURNS INT
		READS SQL DATA
		BEGIN
		  DECLARE done,sid,shouldId INT DEFAULT 0;
		  DECLARE cur1 CURSOR FOR SELECT DISTINCT abs(id) iid FROM ships WHERE abs(id)>=minid ORDER BY iid;
		  DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;
		
		  OPEN cur1;
		  set shouldId = minid;
		  REPEAT
		    FETCH cur1 INTO sid;
		    IF NOT done THEN
		      IF sid <> shouldId THEN
		        CLOSE cur1;
		        RETURN shouldId;
		      END IF;
		      set shouldId = shouldId+1;
		    END IF;
		  UNTIL done END REPEAT;
		
		  CLOSE cur1;
		  RETURN shouldId;
		END;
		//
	]]></update>
	<update type="data" datum="2007-02-07"><![CDATA[
		INSERT INTO `ship_types` (`id`, `nickname`, `picture`, `ru`, `rd`, `ra`, `rm`, `eps`, `cost`, `hull`, `panzerung`, `cargo`, `heat`, `crew`, `weapons`, `maxheat`, `torpedodef`, `shields`, `size`, `jdocks`, `adocks`, `sensorrange`, `hydro`, `recost`, `descrip`, `deutfactor`, `class`, `flags`, `groupwrap`, `werft`, `ow_werft`, `chance4Loot`, `modules`, `shipcount`, `hide`) VALUES (10, 'GTI Arcadia', 'data/schiffe/gcp/gti_arcadia.png', 62, 93, 0, 1565, 4700, 0, 100000, 20, 50000, 0, 19000, 'BGreen=4|TerSlash=9|Terran_Huge_Turret=10|Terran_Turret=15|AAAf=8|standard_flak_ld=6|heavy_flak_ld=6', 'BGreen=60|TerSlash=180|Terran_Huge_Turret=20|Terran_Turret=300|AAAf=160|standard_flak_ld=120|heavy_flak_ld=120', 0, 0, 18, 25, 0, 10, 0, 0, 'Die Arcadia ist einer der gr&ouml;&szlig;ten Au&szlig;enposten der Terraner. Diese Festung dient dazu, Systeme vor feindlicher Invasion zu sch&uuml;tzen, und mit ihren zahlreichen Gesch&uuml;tzen kann sie die Gegner in Schach halten, bis Hilfe eintrifft.\r\n', 0, 8, 'zerstoererpanzerung srs_awac srs_ext_awac secondrow', 10, 'ganymed', 0, 0, '1:misc;2:misc:3:misc;4:misc;5:misc_large_weapon;6:misc_large_weapon;7:misc_large_weapon;8:misc_large_weapon;9:misc_large_weapon;10:misc_large_weapon;11:misc_large_weapon;12:misc_large_weapon;13:misc_large;14:misc_large;15:misc_large;16:misc_large', 1, 0);
		INSERT INTO `ship_types` (`id`, `nickname`, `picture`, `ru`, `rd`, `ra`, `rm`, `eps`, `cost`, `hull`, `panzerung`, `cargo`, `heat`, `crew`, `weapons`, `maxheat`, `torpedodef`, `shields`, `size`, `jdocks`, `adocks`, `sensorrange`, `hydro`, `recost`, `descrip`, `deutfactor`, `class`, `flags`, `groupwrap`, `werft`, `ow_werft`, `chance4Loot`, `modules`, `shipcount`, `hide`) VALUES (27, 'GTT Triton', 'data/schiffe/gcp/gtt_triton.png', 4, 8, 0, 24, 80, 2, 5000, 3, 600, 5, 50, 'Subach_HL-7=1|standard_flak=1', 'Subach_HL-7=5|standard_flak=5', 0, 0, 6, 0, 4, 1, 0, 0, 'Der Standardfrachter des GCP. Obgleich fr&uuml;her nicht in der Lage Standardcontainer zu transportieren, wurde er in den letzten jahren modifiziert um das andocken von bis zu vier containern, Sentrieguns oder J&auml;gern zu erm&ouml;glichen. Dies &auml;ndert jedoch nichts an seiner Schutzlosigkeit, die aus einer schwachen H&uuml;lle und praktisch nicht existenten Bewaffnung resultiert.\r\n\r\nJedes angedockte Objekt erh&ouml;ht die Flugkosten des Schiffes um 1.', 0, 1, '', 10, '', 0, 0, '1:misc', 1, 0);
		INSERT INTO `ship_types` (`id`, `nickname`, `picture`, `ru`, `rd`, `ra`, `rm`, `eps`, `cost`, `hull`, `panzerung`, `cargo`, `heat`, `crew`, `weapons`, `maxheat`, `torpedodef`, `shields`, `size`, `jdocks`, `adocks`, `sensorrange`, `hydro`, `recost`, `descrip`, `deutfactor`, `class`, `flags`, `groupwrap`, `werft`, `ow_werft`, `chance4Loot`, `modules`, `shipcount`, `hide`) VALUES (31, 'Ma at', 'data/schiffe/gcp/gvfr_maat.png', 8, 0, 0, 24, 80, 2, 8500, 4, 1000, 4, 30, 'Subach_HL-7=1|Terran_Turret=3', 'Subach_HL-7=5|Terran_Turret=15', 0, 0, 6, 0, 2, 1, 0, 0, 'Die Ma''at war w&auml;hrend des Gro&szlig;en Krieges der Standard-Transporter der jetztigen Vasudaner. Seine 4 Laserkanonen konnten frechen einzelg&auml;ngerischen GTA-J&auml;ger abwehren, jedoch waren die Ma''at gegen eine Vierer-Staffel machtlos.\r\nAuch heute setzen die Vasudaner die Ma''at als billiges bewaffnetes Transportschiff ein.\r\n\r\nJedes angedockte Objekt erh&ouml;ht die Flugkosten des Schiffes um 1.', 0, 1, '', 10, '', 0, 0, '1:misc', 1, 0);
	]]></update>
	<update type="structure" datum="2007-02-07"><![CDATA[
		ALTER TABLE ships ADD CONSTRAINT ships_type_fk FOREIGN KEY (type) REFERENCES ship_types(id);
		ALTER TABLE ships_baubar ADD CONSTRAINT ships_baubar_type_fk FOREIGN KEY (type) REFERENCES ship_types(id);
	]]></update>
</updates>
